{% extends "base.html" %}

{% set page_title = "Crear Paquete" if mode == 'create' else "Editar Paquete" %}

{% block title %}{{ page_title }} - PuroBeach{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
        <i class="fa-solid fa-box"></i>
        {{ page_title }}
    </h2>
    <a href="{{ url_for('beach.beach_config.packages') }}" class="btn btn-secondary">
        <i class="fa-solid fa-arrow-left"></i> Volver
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <h6 class="mb-3">Informacion Basica</h6>

                    <div class="mb-3">
                        <label for="package_name" class="form-label">Nombre del Paquete <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="package_name" name="package_name"
                               value="{{ package.package_name if package else '' }}"
                               required maxlength="255" placeholder="Paquete Premium">
                    </div>

                    <div class="mb-3">
                        <label for="package_description" class="form-label">Descripcion</label>
                        <textarea class="form-control" id="package_description" name="package_description"
                                  rows="3" placeholder="Descripcion detallada del paquete...">{{ package.package_description if package else '' }}</textarea>
                    </div>

                    <hr>
                    <h6 class="mb-3">Precios y Capacidad</h6>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="base_price" class="form-label">Precio Base (€) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="base_price" name="base_price"
                                       value="{{ package.base_price if package else '' }}"
                                       required min="0.01" step="0.01" placeholder="100.00">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="price_type" class="form-label">Tipo de Precio <span class="text-danger">*</span></label>
                                <select class="form-select" id="price_type" name="price_type" required>
                                    <option value="per_package" {% if not package or package.price_type == 'per_package' %}selected{% endif %}>
                                        Por Paquete (precio fijo)
                                    </option>
                                    <option value="per_person" {% if package and package.price_type == 'per_person' %}selected{% endif %}>
                                        Por Persona (precio x personas)
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="min_people" class="form-label">Personas Minimas</label>
                                <input type="number" class="form-control" id="min_people" name="min_people"
                                       value="{{ package.min_people if package else 1 }}"
                                       min="1" max="20" placeholder="1">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="standard_people" class="form-label">Personas Estandar</label>
                                <input type="number" class="form-control" id="standard_people" name="standard_people"
                                       value="{{ package.standard_people if package else 2 }}"
                                       min="1" max="20" placeholder="2">
                                <div class="form-text">Capacidad recomendada</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="max_people" class="form-label">Personas Maximas</label>
                                <input type="number" class="form-control" id="max_people" name="max_people"
                                       value="{{ package.max_people if package else 4 }}"
                                       min="1" max="20" placeholder="4">
                            </div>
                        </div>
                    </div>

                    <hr>
                    <h6 class="mb-3">Restricciones y Validez</h6>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="customer_type" class="form-label">Tipo de Cliente</label>
                                <select class="form-select" id="customer_type" name="customer_type">
                                    <option value="" {% if not package or not package.customer_type %}selected{% endif %}>
                                        Todos
                                    </option>
                                    <option value="interno" {% if package and package.customer_type == 'interno' %}selected{% endif %}>
                                        Solo Internos
                                    </option>
                                    <option value="externo" {% if package and package.customer_type == 'externo' %}selected{% endif %}>
                                        Solo Externos
                                    </option>
                                    <option value="both" {% if package and package.customer_type == 'both' %}selected{% endif %}>
                                        Ambos
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="zone_id" class="form-label">Zona</label>
                                <select class="form-select" id="zone_id" name="zone_id">
                                    <option value="" {% if not package or not package.zone_id %}selected{% endif %}>
                                        Todas las Zonas
                                    </option>
                                    {% for zone in zones %}
                                    <option value="{{ zone.id }}" {% if package and package.zone_id == zone.id %}selected{% endif %}>
                                        {{ zone.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="furniture_types_included" class="form-label">Tipos de Mobiliario Incluidos</label>
                        <input type="text" class="form-control" id="furniture_types_included" name="furniture_types_included"
                               value="{{ package.furniture_types_included if package else '' }}"
                               placeholder="hamaca, balinesa (separados por comas)">
                        <div class="form-text">Tipos de mobiliario que incluye el paquete, separados por comas</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="valid_from" class="form-label">Valido Desde</label>
                                <input type="date" class="form-control" id="valid_from" name="valid_from"
                                       value="{{ package.valid_from if package else '' }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="valid_until" class="form-label">Valido Hasta</label>
                                <input type="date" class="form-control" id="valid_until" name="valid_until"
                                       value="{{ package.valid_until if package else '' }}">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="display_order" class="form-label">Orden de Display</label>
                        <input type="number" class="form-control" id="display_order" name="display_order"
                               value="{{ package.display_order if package else 0 }}"
                               min="0" max="100" placeholder="0">
                        <div class="form-text">Orden en que se muestra en listados (menor primero)</div>
                    </div>

                    {% if mode == 'edit' %}
                    <hr>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="active" name="active" value="1"
                                   {% if package.active %}checked{% endif %}>
                            <label class="form-check-label" for="active">Paquete activo</label>
                        </div>
                    </div>
                    {% endif %}

                    <hr>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-save"></i>
                            {{ 'Crear Paquete' if mode == 'create' else 'Guardar Cambios' }}
                        </button>
                        <a href="{{ url_for('beach.beach_config.packages') }}" class="btn btn-secondary">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        {% if mode == 'edit' and package %}
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Informacion</h5>
            </div>
            <div class="card-body">
                <p class="small mb-1">
                    <strong>Reservas con este paquete:</strong> {{ package.usage_count or 0 }}
                </p>
                <p class="small mb-1">
                    <strong>Creado:</strong> {{ (package.created_at|string)[:10] if package.created_at else 'N/A' }}
                </p>
                <p class="small mb-0">
                    <strong>Actualizado:</strong> {{ (package.updated_at|string)[:10] if package.updated_at else 'N/A' }}
                </p>
            </div>
        </div>
        {% endif %}

        <div class="card {% if mode == 'edit' and package %}mt-3{% endif %}">
            <div class="card-header">
                <h5 class="card-title mb-0">Ayuda</h5>
            </div>
            <div class="card-body">
                <p class="small mb-2"><strong>Tipo de Precio:</strong></p>
                <ul class="small mb-3">
                    <li><strong>Por Paquete:</strong> Precio fijo sin importar personas</li>
                    <li><strong>Por Persona:</strong> Precio base × número de personas</li>
                </ul>

                <p class="small mb-2"><strong>Rango de Personas:</strong></p>
                <p class="small mb-3">Define capacidad mínima, estándar (recomendada) y máxima del paquete.</p>

                <p class="small mb-2"><strong>Restricciones:</strong></p>
                <p class="small mb-0">Limita el paquete a ciertos tipos de clientes o zonas específicas.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
