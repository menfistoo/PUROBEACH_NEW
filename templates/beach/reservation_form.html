{% extends "base.html" %}

{% set page_title = "Nueva Reserva" if mode == 'create' else "Editar Reserva" %}

{% block title %}{{ page_title }} - PuroBeach{% endblock %}

{% block content %}
<div class="mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('beach.reservations') }}">Reservas</a></li>
            <li class="breadcrumb-item active">{{ page_title }}</li>
        </ol>
    </nav>
    <h2><i class="fas fa-calendar-plus"></i> {{ page_title }}</h2>
</div>

<form method="POST" id="reservationForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="row">
        <!-- Left Column: Main Form -->
        <div class="col-lg-8">
            <!-- Customer Selection -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user"></i> Cliente</h5>
                </div>
                <div class="card-body">
                    {% if mode == 'create' %}
                    <!-- Customer Type Filter -->
                    <div class="mb-3">
                        <label class="form-label">Tipo de Cliente</label>
                        <select id="customerTypeFilter" class="form-select">
                            <option value="">Todos los clientes</option>
                            <option value="interno">Internos (Hotel)</option>
                            <option value="externo">Externos</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Buscar Cliente <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="text" id="customerSearch" class="form-control"
                                   placeholder="Buscar por nombre, teléfono, habitación..."
                                   autocomplete="off">
                            <button type="button" class="btn btn-outline-secondary" id="clearCustomer"
                                    style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="customerResults" class="list-group mt-1" style="display: none; position: absolute; z-index: 1000; width: calc(100% - 2rem);"></div>
                        <small class="text-muted">Busca entre clientes registrados y huéspedes del hotel</small>
                    </div>

                    <input type="hidden" name="customer_id" id="customerId" value="">

                    <div id="selectedCustomer" class="alert alert-info" style="display: none;">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong id="customerName"></strong>
                                <div class="small" id="customerDetails"></div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#newCustomerModal">
                                <i class="fas fa-plus"></i> Nuevo Cliente
                            </button>
                        </div>
                    </div>
                    {% else %}
                    <!-- Edit mode: Show customer info read-only -->
                    <div class="alert alert-secondary">
                        <strong>{{ reservation.customer_name }}</strong>
                        <div class="small">
                            {% if reservation.customer_type == 'interno' %}
                            <i class="fas fa-hotel"></i> Hab. {{ reservation.customer_room or '-' }}
                            {% else %}
                            <i class="fas fa-user"></i> Externo
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Date & People -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-calendar"></i> Fecha y Personas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Fecha <span class="text-danger">*</span></label>
                            <input type="date" name="reservation_date" id="reservationDate" class="form-control" required
                                   value="{{ reservation.reservation_date if reservation else (selected_date or '') }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Horario</label>
                            <select name="time_slot" class="form-select">
                                <option value="all_day" {% if not reservation or reservation.time_slot == 'all_day' %}selected{% endif %}>Todo el día</option>
                                <option value="morning" {% if reservation and reservation.time_slot == 'morning' %}selected{% endif %}>Mañana</option>
                                <option value="afternoon" {% if reservation and reservation.time_slot == 'afternoon' %}selected{% endif %}>Tarde</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Personas <span class="text-danger">*</span></label>
                            <input type="number" name="num_people" id="numPeople" class="form-control"
                                   min="1" max="20" required
                                   value="{{ reservation.num_people if reservation else 2 }}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Furniture Selection -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-couch"></i> Mobiliario</h5>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="refreshFurniture">
                        <i class="fas fa-sync"></i> Actualizar
                    </button>
                </div>
                <div class="card-body">
                    <!-- Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <select id="furnitureZoneFilter" class="form-select form-select-sm">
                                <option value="">Todas las zonas</option>
                                {% for zone in zones %}
                                <option value="{{ zone.id }}">{{ zone.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select id="furnitureTypeFilter" class="form-select form-select-sm">
                                <option value="">Todos los tipos</option>
                                {% for ft in furniture_types %}
                                <option value="{{ ft.type_code }}">{{ ft.display_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Furniture Grid -->
                    <div id="furnitureGrid" class="row g-2">
                        <div class="col-12 text-center py-5 text-muted">
                            <i class="fas fa-calendar fa-2x mb-2"></i>
                            <p>Seleccione una fecha para ver disponibilidad</p>
                        </div>
                    </div>

                    <!-- Selected count -->
                    <div class="mt-3 text-muted">
                        <small>Seleccionados: <strong id="selectedCount">0</strong></small>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-sticky-note"></i> Notas</h5>
                </div>
                <div class="card-body">
                    <textarea name="notes" class="form-control" rows="3"
                              placeholder="Observaciones para la reserva...">{{ reservation.notes if reservation else '' }}</textarea>
                </div>
            </div>
        </div>

        <!-- Right Column: Sidebar -->
        <div class="col-lg-4">
            <!-- Payment -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-credit-card"></i> Pago</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Estado de Pago</label>
                        <select name="payment_status" class="form-select">
                            <option value="NO" {% if not reservation or reservation.payment_status == 'NO' %}selected{% endif %}>Pendiente</option>
                            <option value="SÍ" {% if reservation and reservation.payment_status == 'SÍ' %}selected{% endif %}>Pagado</option>
                        </select>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" name="charge_to_room" id="chargeToRoom"
                               value="1" {% if reservation and reservation.charge_to_room %}checked{% endif %}>
                        <label class="form-check-label" for="chargeToRoom">
                            Cargar a habitación
                        </label>
                    </div>
                    <div id="chargeRefContainer" style="display: {% if reservation and reservation.charge_to_room %}block{% else %}none{% endif %};">
                        <label class="form-label">Referencia de cargo</label>
                        <input type="text" name="charge_reference" class="form-control"
                               value="{{ reservation.charge_reference if reservation else '' }}"
                               placeholder="Ej: Habitación 205">
                    </div>
                </div>
            </div>

            <!-- Preferences -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-heart"></i> Preferencias</h5>
                </div>
                <div class="card-body">
                    {% set current_prefs = (reservation.preferences or '').split(',') if reservation else [] %}
                    {% for pref in preferences %}
                    <div class="form-check mb-2">
                        <input class="form-check-input preference-check" type="checkbox"
                               name="preferences" value="{{ pref.code }}"
                               id="pref_{{ pref.id }}"
                               {% if pref.code in current_prefs %}checked{% endif %}>
                        <label class="form-check-label" for="pref_{{ pref.id }}">
                            {% if pref.icon %}<i class="fas {{ pref.icon }} me-1"></i>{% endif %}
                            {{ pref.name }}
                        </label>
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">No hay preferencias configuradas</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Actions -->
            <div class="card">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary w-100 mb-2">
                        <i class="fas fa-save"></i>
                        {% if mode == 'create' %}Crear Reserva{% else %}Guardar Cambios{% endif %}
                    </button>
                    <a href="{{ url_for('beach.reservations') }}" class="btn btn-secondary w-100">
                        <i class="fas fa-times"></i> Cancelar
                    </a>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Customer Creation Modal -->
<div class="modal fade" id="newCustomerModal" tabindex="-1" aria-labelledby="newCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newCustomerModalLabel">
                    <i class="fas fa-user-plus"></i> Nuevo Cliente
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tipo de Cliente <span class="text-danger">*</span></label>
                    <select id="newCustomerType" class="form-select" required>
                        <option value="interno">Interno (Hotel)</option>
                        <option value="externo">Externo</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Nombre <span class="text-danger">*</span></label>
                    <input type="text" id="newCustomerFirstName" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Apellidos</label>
                    <input type="text" id="newCustomerLastName" class="form-control">
                </div>
                <div class="mb-3" id="roomNumberField">
                    <label class="form-label">Habitación <span class="text-danger">*</span></label>
                    <input type="text" id="newCustomerRoom" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Teléfono</label>
                    <input type="text" id="newCustomerPhone" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" id="newCustomerEmail" class="form-control">
                </div>
                <div id="newCustomerError" class="alert alert-danger" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveNewCustomer">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('reservationForm');
    const customerSearch = document.getElementById('customerSearch');
    const customerResults = document.getElementById('customerResults');
    const customerId = document.getElementById('customerId');
    const selectedCustomer = document.getElementById('selectedCustomer');
    const clearCustomerBtn = document.getElementById('clearCustomer');
    const customerTypeFilter = document.getElementById('customerTypeFilter');
    const reservationDate = document.getElementById('reservationDate');
    const furnitureGrid = document.getElementById('furnitureGrid');
    const selectedCount = document.getElementById('selectedCount');
    const refreshBtn = document.getElementById('refreshFurniture');
    const zoneFilter = document.getElementById('furnitureZoneFilter');
    const typeFilter = document.getElementById('furnitureTypeFilter');
    const chargeToRoom = document.getElementById('chargeToRoom');
    const chargeRefContainer = document.getElementById('chargeRefContainer');
    const csrfToken = '{{ csrf_token() }}';

    let selectedFurniture = new Set();
    let furnitureData = [];

    // Initialize with existing furniture if editing
    {% if mode == 'edit' and reservation.furniture %}
    {% for f in reservation.furniture %}
    selectedFurniture.add({{ f.furniture_id }});
    {% endfor %}
    {% endif %}

    // Helper function to select a customer
    function selectCustomer(customer) {
        customerId.value = customer.id;
        customerSearch.value = '';
        customerResults.style.display = 'none';

        const displayName = customer.display_name || `${customer.first_name} ${customer.last_name || ''}`.trim();
        document.getElementById('customerName').textContent = displayName;
        document.getElementById('customerDetails').innerHTML = `
            ${customer.customer_type === 'interno' ? '<i class="fas fa-hotel"></i> Hab. ' + (customer.room_number || '-') : '<i class="fas fa-user"></i> Externo'}
            ${customer.phone ? ' | <i class="fas fa-phone"></i> ' + customer.phone : ''}
        `;
        selectedCustomer.style.display = 'block';
        clearCustomerBtn.style.display = 'block';
    }

    // Customer search (create mode only)
    {% if mode == 'create' %}
    let searchTimeout;
    if (customerSearch) {
        customerSearch.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();

            if (query.length < 2) {
                customerResults.style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(() => {
                const typeParam = customerTypeFilter ? customerTypeFilter.value : '';
                let url = `{{ url_for('beach.api_customers_search') }}?q=${encodeURIComponent(query)}`;
                if (typeParam) url += `&type=${typeParam}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.customers.length > 0) {
                            customerResults.innerHTML = data.customers.map(c => {
                                const isHotelGuest = c.source === 'hotel_guest';
                                const displayName = isHotelGuest ? c.guest_name : `${c.first_name} ${c.last_name || ''}`;
                                const vipBadge = (c.vip_status || c.vip_code) ? '<span class="badge bg-warning text-dark ms-1"><i class="fas fa-star"></i></span>' : '';
                                const sourceBadge = isHotelGuest ? '<span class="badge bg-info ms-1">Huésped</span>' : '';

                                return `
                                    <button type="button" class="list-group-item list-group-item-action"
                                            data-id="${c.id}"
                                            data-source="${c.source}"
                                            data-name="${displayName}"
                                            data-type="${c.customer_type}"
                                            data-room="${c.room_number || ''}"
                                            data-phone="${c.phone || ''}">
                                        <strong>${displayName}</strong>
                                        ${vipBadge}
                                        ${sourceBadge}
                                        <br>
                                        <small class="text-muted">
                                            ${c.customer_type === 'interno' ? '<i class="fas fa-hotel"></i> Hab. ' + (c.room_number || '-') : '<i class="fas fa-user"></i> Externo'}
                                            ${c.phone ? ' | <i class="fas fa-phone"></i> ' + c.phone : ''}
                                            ${isHotelGuest && c.departure_date ? ' | Salida: ' + c.departure_date : ''}
                                        </small>
                                    </button>
                                `;
                            }).join('');
                            customerResults.style.display = 'block';
                        } else {
                            customerResults.innerHTML = `
                                <div class="list-group-item text-muted">
                                    No se encontraron clientes
                                    <button type="button" class="btn btn-sm btn-link p-0 ms-2" data-bs-toggle="modal" data-bs-target="#newCustomerModal">
                                        <i class="fas fa-plus"></i> Crear nuevo
                                    </button>
                                </div>
                            `;
                            customerResults.style.display = 'block';
                        }
                    });
            }, 300);
        });

        // Customer type filter change clears search and re-searches if query exists
        if (customerTypeFilter) {
            customerTypeFilter.addEventListener('change', function() {
                if (customerSearch.value.trim().length >= 2) {
                    customerSearch.dispatchEvent(new Event('input'));
                }
            });
        }

        customerResults.addEventListener('click', function(e) {
            const btn = e.target.closest('button[data-id]');
            if (btn) {
                const id = btn.dataset.id;
                const source = btn.dataset.source;
                const name = btn.dataset.name;
                const type = btn.dataset.type;
                const room = btn.dataset.room;
                const phone = btn.dataset.phone;

                // If it's a hotel guest, convert to customer first
                if (source === 'hotel_guest') {
                    fetch('{{ url_for("beach.api_customers_from_hotel_guest") }}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify({ hotel_guest_id: parseInt(id) })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            selectCustomer(data.customer);
                        } else {
                            alert('Error: ' + (data.error || 'No se pudo crear el cliente'));
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('Error al convertir huésped a cliente');
                    });
                } else {
                    // Regular customer - just select it
                    selectCustomer({
                        id: id,
                        display_name: name,
                        customer_type: type,
                        room_number: room,
                        phone: phone
                    });
                }
            }
        });

        if (clearCustomerBtn) {
            clearCustomerBtn.addEventListener('click', function() {
                customerId.value = '';
                selectedCustomer.style.display = 'none';
                clearCustomerBtn.style.display = 'none';
                customerSearch.value = '';
            });
        }
    }

    // New Customer Modal
    const newCustomerModal = document.getElementById('newCustomerModal');
    const newCustomerType = document.getElementById('newCustomerType');
    const roomNumberField = document.getElementById('roomNumberField');
    const newCustomerError = document.getElementById('newCustomerError');

    // Toggle room number field based on customer type
    if (newCustomerType) {
        newCustomerType.addEventListener('change', function() {
            roomNumberField.style.display = this.value === 'interno' ? 'block' : 'none';
        });
    }

    // Save new customer
    const saveNewCustomerBtn = document.getElementById('saveNewCustomer');
    if (saveNewCustomerBtn) {
        saveNewCustomerBtn.addEventListener('click', function() {
            const data = {
                customer_type: document.getElementById('newCustomerType').value,
                first_name: document.getElementById('newCustomerFirstName').value.trim(),
                last_name: document.getElementById('newCustomerLastName').value.trim(),
                room_number: document.getElementById('newCustomerRoom').value.trim(),
                phone: document.getElementById('newCustomerPhone').value.trim(),
                email: document.getElementById('newCustomerEmail').value.trim()
            };

            // Basic validation
            if (!data.first_name) {
                newCustomerError.textContent = 'El nombre es requerido';
                newCustomerError.style.display = 'block';
                return;
            }
            if (data.customer_type === 'interno' && !data.room_number) {
                newCustomerError.textContent = 'El número de habitación es requerido para clientes internos';
                newCustomerError.style.display = 'block';
                return;
            }

            newCustomerError.style.display = 'none';
            saveNewCustomerBtn.disabled = true;
            saveNewCustomerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

            fetch('{{ url_for("beach.api_customers_create") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                saveNewCustomerBtn.disabled = false;
                saveNewCustomerBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';

                if (result.success) {
                    // Close modal and select customer
                    bootstrap.Modal.getInstance(newCustomerModal).hide();
                    selectCustomer(result.customer);

                    // Clear modal fields
                    document.getElementById('newCustomerFirstName').value = '';
                    document.getElementById('newCustomerLastName').value = '';
                    document.getElementById('newCustomerRoom').value = '';
                    document.getElementById('newCustomerPhone').value = '';
                    document.getElementById('newCustomerEmail').value = '';
                } else {
                    newCustomerError.textContent = result.error || 'Error al crear cliente';
                    newCustomerError.style.display = 'block';
                }
            })
            .catch(err => {
                saveNewCustomerBtn.disabled = false;
                saveNewCustomerBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';
                newCustomerError.textContent = 'Error de conexión';
                newCustomerError.style.display = 'block';
            });
        });
    }

    // Reset modal on close
    if (newCustomerModal) {
        newCustomerModal.addEventListener('hidden.bs.modal', function() {
            newCustomerError.style.display = 'none';
            document.getElementById('newCustomerFirstName').value = '';
            document.getElementById('newCustomerLastName').value = '';
            document.getElementById('newCustomerRoom').value = '';
            document.getElementById('newCustomerPhone').value = '';
            document.getElementById('newCustomerEmail').value = '';
        });
    }
    {% endif %}

    // Charge to room toggle
    if (chargeToRoom) {
        chargeToRoom.addEventListener('change', function() {
            chargeRefContainer.style.display = this.checked ? 'block' : 'none';
        });
    }

    // Date change handler
    reservationDate.addEventListener('change', loadFurnitureAvailability);

    // Furniture availability
    function loadFurnitureAvailability() {
        const dateVal = reservationDate.value;
        if (!dateVal) return;

        const params = new URLSearchParams({ date: dateVal });
        if (zoneFilter.value) params.append('zone_id', zoneFilter.value);
        if (typeFilter.value) params.append('type', typeFilter.value);

        furnitureGrid.innerHTML = '<div class="col-12 text-center py-3"><i class="fas fa-spinner fa-spin"></i> Cargando...</div>';

        fetch(`{{ url_for('beach.api_available_furniture') }}?${params}`)
            .then(response => response.json())
            .then(data => {
                furnitureData = data.furniture || [];
                renderFurnitureGrid();
            })
            .catch(err => {
                furnitureGrid.innerHTML = '<div class="col-12 text-center py-3 text-danger">Error al cargar mobiliario</div>';
            });
    }

    function renderFurnitureGrid() {
        let html = '';

        furnitureData.forEach(f => {
            const isSelected = selectedFurniture.has(f.id);
            const bgClass = isSelected ? 'bg-primary text-white' : 'bg-light';

            html += `
                <div class="col-4 col-md-3 col-lg-2">
                    <div class="card furniture-item ${bgClass} cursor-pointer"
                         data-id="${f.id}"
                         style="border: 2px solid ${isSelected ? '#0d6efd' : '#dee2e6'}">
                        <div class="card-body p-2 text-center">
                            <div class="fw-bold">${f.number}</div>
                            <small>${f.type_name || f.furniture_type}</small>
                            <div class="small opacity-75">
                                <i class="fas fa-users"></i> ${f.capacity}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });

        if (furnitureData.length === 0) {
            html = '<div class="col-12 text-center py-3 text-muted">No hay mobiliario disponible</div>';
        }

        furnitureGrid.innerHTML = html;
        updateSelectedCount();

        // Add click handlers
        document.querySelectorAll('.furniture-item').forEach(item => {
            item.addEventListener('click', function() {
                const id = parseInt(this.dataset.id);
                if (selectedFurniture.has(id)) {
                    selectedFurniture.delete(id);
                } else {
                    selectedFurniture.add(id);
                }
                renderFurnitureGrid();
            });
        });
    }

    function updateSelectedCount() {
        selectedCount.textContent = selectedFurniture.size;
    }

    // Filter handlers
    refreshBtn.addEventListener('click', loadFurnitureAvailability);
    zoneFilter.addEventListener('change', loadFurnitureAvailability);
    typeFilter.addEventListener('change', loadFurnitureAvailability);

    // Form submission
    form.addEventListener('submit', function(e) {
        // Add selected furniture as hidden inputs
        document.querySelectorAll('input[name="furniture_ids"]').forEach(el => el.remove());

        selectedFurniture.forEach(id => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'furniture_ids';
            input.value = id;
            form.appendChild(input);
        });

        // Validate
        {% if mode == 'create' %}
        if (!customerId.value) {
            e.preventDefault();
            alert('Debe seleccionar un cliente');
            return;
        }
        {% endif %}

        if (selectedFurniture.size === 0) {
            e.preventDefault();
            alert('Debe seleccionar al menos un mobiliario');
            return;
        }
    });

    // Initial load if date is set
    if (reservationDate.value) {
        loadFurnitureAvailability();
    }
});
</script>

<style>
.furniture-item {
    transition: all 0.2s ease;
    cursor: pointer;
}
.furniture-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
#customerResults {
    max-height: 300px;
    overflow-y: auto;
}
</style>
{% endblock %}
