# Issues - 25/12/25

## Status: DONE

---

### Issue 1: Duplicate booking map jump [DONE]
**Problem:** When the system detects a duplicate booking and I choose to view the existing booking, I want the sunbed selection on the map to automatically jump to the sunbeds for that booking.

**Solution:**
- Modified `reservation:openExisting` event handler in `map.html`
- After opening the reservation panel, fetches reservation details via API
- Selects all furniture assigned to that reservation on the map
- Updates the selection bar to show the selected furniture
- **UPDATE:** Added pulsing red border highlight for 5 seconds
  - CSS animation with red stroke (#C1444F) and drop shadow
  - Auto-removes after 5 seconds for cleanup
  - Fixed date parsing to handle RFC format dates from API

**Files changed:**
- `templates/beach/map.html`

---

### Issue 2: Fechas fuera de estadia notification [DONE]
**Problem:** The system is not successfully pulling the check-in and check-out dates resulting in all reservations having this notification.

**Solution:**
- Added date normalization in `checkHotelStayDates()` method
- Handles ISO format dates (with 'T' separator) and plain dates
- Ensures consistent YYYY-MM-DD format for comparison
- Added null/invalid date handling to skip check gracefully

**Files changed:**
- `static/js/map/new-reservation-panel.js`

---

### Issue 3: Sunbed excess warning [DONE]
**Problem:** There is already a notification when there are more guests than sunbeds, but I need the opposite to also be true. If there are fewer guests than sunbeds (e.g., selected 2 sunbeds but only 1 guest), the system should prompt me to confirm whether I want to continue or fix it.

**Solution:**
- Added new `showExcessCapacityWarning()` method in SafeguardModal (code: SG-04b)
- Shows warning with guest count, furniture capacity, and excess seats
- User can Cancel or Continue with the selection
- Modified `checkCapacityMismatch()` in new-reservation-panel.js to check both directions

**Files changed:**
- `static/js/map/safeguard-modal.js`
- `static/js/map/new-reservation-panel.js`

---

## Testing Checklist

- [x] Duplicate booking: Create a reservation, try to create duplicate, click "View existing" - verify sunbeds show pulsing red border for 5 seconds
- [x] Hotel stay dates: Select a hotel guest with valid stay dates, book within stay period - verify no warning appears
- [x] Excess capacity: Select 2 sunbeds for 1 guest - verify "Mobiliario excedente" warning appears with option to Cancel or Continue